name: CI

on: [push, pull_request]

jobs:
  markdown-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint Markdown files
        uses: DavidAnson/markdownlint-cli2-action@v16
        with:
          globs: '**/*.md'
  
  xml-validation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check XML files exist and basic structure
        run: |
          sudo apt-get update
          sudo apt-get install -y libxml2-utils
          find protocol -name "*.xml" | while read file; do
            echo "Checking $file..."
            if xmllint --noout "$file" 2>&1 | grep -q "parser error"; then
              echo "::warning file=$file::XML validation warnings found in $file"
            fi
          done
          echo "XML structure check completed."
  
  file-structure:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Verify required files exist
        run: |
          REQUIRED_FILES="README.md LICENSE CONTRIBUTING.md COMMERCIAL_LICENSING.md implementation-guide.md"
          for file in $REQUIRED_FILES; do
            if [ ! -f "$file" ]; then
              echo "::error file=$file::Required file missing: $file"
              exit 1
            fi
          done
          echo "All required files present."
